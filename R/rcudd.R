#' @useDynLib Rcudd, .registration=TRUE
NULL

.cudd_native <- new.env(parent = emptyenv())

.onLoad <- function(libname, pkgname) {
  symbols <- c(
    "c_bdd_remaining_literals",
    "c_bdd_restrict_chain",
    "c_cudd_add_epd_print_minterm",
    "c_cudd_add_one",
    "c_cudd_add_plus",
    "c_cudd_add_print_minterm",
    "c_cudd_add_times",
    "c_cudd_add_to_bdd",
    "c_cudd_add_var",
    "c_cudd_add_zero",
    "c_cudd_autodyn_disable",
    "c_cudd_autodyn_disable_zdd",
    "c_cudd_autodyn_enable",
    "c_cudd_autodyn_enable_zdd",
    "c_cudd_background",
    "c_cudd_bdd_and",
    "c_cudd_bdd_bind_var",
    "c_cudd_bdd_dump_dot",
    "c_cudd_bdd_epd_print_minterm",
    "c_cudd_bdd_not",
    "c_cudd_bdd_one",
    "c_cudd_bdd_or",
    "c_cudd_bdd_print_debug",
    "c_cudd_bdd_print_minterm",
    "c_cudd_bdd_realign_disable",
    "c_cudd_bdd_realign_enable",
    "c_cudd_bdd_realignment_enabled",
    "c_cudd_bdd_to_add",
    "c_cudd_bdd_to_zdd",
    "c_cudd_bdd_unbind_var",
    "c_cudd_bdd_var",
    "c_cudd_bdd_var_is_bound",
    "c_cudd_bdd_xor",
    "c_cudd_bdd_zero",
    "c_cudd_clear_error_code",
    "c_cudd_clear_variable_names",
    "c_cudd_dead_are_counted",
    "c_cudd_disable_garbage_collection",
    "c_cudd_disable_reordering_reporting",
    "c_cudd_enable_garbage_collection",
    "c_cudd_enable_reordering_reporting",
    "c_cudd_garbage_collection_enabled",
    "c_cudd_get_variable_name",
    "c_cudd_increase_time_limit",
    "c_cudd_info",
    "c_cudd_is_verbose",
    "c_cudd_make_terse",
    "c_cudd_make_verbose",
    "c_cudd_new",
    "c_cudd_push_variable_name",
    "c_cudd_read_arcviolation",
    "c_cudd_read_cache_hits",
    "c_cudd_read_cache_lookups",
    "c_cudd_read_cache_slots",
    "c_cudd_read_cache_used_slots",
    "c_cudd_read_dead",
    "c_cudd_read_elapsed_time",
    "c_cudd_read_epsilon",
    "c_cudd_read_error_code",
    "c_cudd_read_garbage_collection_time",
    "c_cudd_read_garbage_collections",
    "c_cudd_read_groupcheck",
    "c_cudd_read_inv_perm",
    "c_cudd_read_inv_perm_zdd",
    "c_cudd_read_keys",
    "c_cudd_read_loose_up_to",
    "c_cudd_read_max_cache",
    "c_cudd_read_max_cache_hard",
    "c_cudd_read_max_growth",
    "c_cudd_read_max_live",
    "c_cudd_read_max_memory",
    "c_cudd_read_max_reorderings",
    "c_cudd_read_memory_in_use",
    "c_cudd_read_min_dead",
    "c_cudd_read_min_hit",
    "c_cudd_read_next_reordering",
    "c_cudd_read_node_count",
    "c_cudd_read_node_count_current",
    "c_cudd_read_node_count_zdd",
    "c_cudd_read_number_xovers",
    "c_cudd_read_order_randomization",
    "c_cudd_read_peak_node_count",
    "c_cudd_read_perm",
    "c_cudd_read_perm_zdd",
    "c_cudd_read_population_size",
    "c_cudd_read_recomb",
    "c_cudd_read_reordering_time",
    "c_cudd_read_reorderings",
    "c_cudd_read_sift_max_swap",
    "c_cudd_read_sift_max_var",
    "c_cudd_read_size",
    "c_cudd_read_slots",
    "c_cudd_read_start_time",
    "c_cudd_read_swap_steps",
    "c_cudd_read_symmviolation",
    "c_cudd_read_time_limit",
    "c_cudd_read_vars",
    "c_cudd_read_zdd_size",
    "c_cudd_reordering_reporting",
    "c_cudd_reordering_status",
    "c_cudd_reordering_status_zdd",
    "c_cudd_reset_start_time",
    "c_cudd_set_arcviolation",
    "c_cudd_set_background",
    "c_cudd_set_epsilon",
    "c_cudd_set_groupcheck",
    "c_cudd_set_loose_up_to",
    "c_cudd_set_max_cache_hard",
    "c_cudd_set_max_growth",
    "c_cudd_set_max_live",
    "c_cudd_set_max_memory",
    "c_cudd_set_max_reorderings",
    "c_cudd_set_min_hit",
    "c_cudd_set_next_reordering",
    "c_cudd_set_number_xovers",
    "c_cudd_set_order_randomization",
    "c_cudd_set_population_size",
    "c_cudd_set_recomb",
    "c_cudd_set_sift_max_swap",
    "c_cudd_set_sift_max_var",
    "c_cudd_set_start_time",
    "c_cudd_set_symmviolation",
    "c_cudd_set_time_limit",
    "c_cudd_time_limited",
    "c_cudd_turn_off_count_dead",
    "c_cudd_turn_on_count_dead",
    "c_cudd_unset_time_limit",
    "c_cudd_update_time_limit",
    "c_cudd_zdd_intersect",
    "c_cudd_zdd_one",
    "c_cudd_zdd_print_minterm",
    "c_cudd_zdd_realign_disable",
    "c_cudd_zdd_realign_enable",
    "c_cudd_zdd_realignment_enabled",
    "c_cudd_zdd_to_bdd",
    "c_cudd_zdd_union",
    "c_cudd_zdd_var",
    "c_cudd_zdd_zero"
  )
  for (name in symbols) {
    assign(name, getNativeSymbolInfo(name, PACKAGE = pkgname)$address, envir = .cudd_native)
  }
  return(invisible(NULL))
}

.cudd_check_same_manager <- function(lhs, rhs, op) {
  same_manager <- identical(lhs@manager_ptr, rhs@manager_ptr)
  if (!same_manager) {
    warning(
      sprintf("Objects for %s come from different CuddManager instances.", op),
      call. = FALSE
    )
  }
  return(same_manager)
}
